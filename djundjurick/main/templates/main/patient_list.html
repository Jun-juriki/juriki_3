<!DOCTYPE html>
<html>
<head>
    <title>–°–ø–∏—Å–æ–∫ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .nav { margin-bottom: 20px; }
        .nav a { margin-right: 15px; text-decoration: none; color: #007bff; }
        .patient-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .patient-table th, .patient-table td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        .patient-table th { background-color: #f8f9fa; }
        .urgency-1 { background-color: #ffcccc; }
        .urgency-2 { background-color: #ffe6cc; }
        .urgency-3 { background-color: #ffffcc; }
        .urgency-4 { background-color: #e6ffe6; }
        .filters { background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .empty-message { text-align: center; padding: 40px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <a href="{% url 'index' %}">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="{% url 'patient-list' %}">üìã –í—Å–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã</a>
        </div>

        <h1>üìã –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫–∞—Ä—Ç –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</h1>

        <div class="filters">
            <form method="get">
                <select name="urgency">
                    <option value="">–í—Å–µ —É—Ä–æ–≤–Ω–∏ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏</option>
                    <option value="1" {% if request.GET.urgency == '1' %}selected{% endif %}>üî¥ –£—Ä–æ–≤–µ–Ω—å 1</option>
                    <option value="2" {% if request.GET.urgency == '2' %}selected{% endif %}>üü† –£—Ä–æ–≤–µ–Ω—å 2</option>
                    <option value="3" {% if request.GET.urgency == '3' %}selected{% endif %}>üü° –£—Ä–æ–≤–µ–Ω—å 3</option>
                    <option value="4" {% if request.GET.urgency == '4' %}selected{% endif %}>üü¢ –£—Ä–æ–≤–µ–Ω—å 4</option>
                </select>
                <button type="submit">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
                <a href="{% url 'patient-list' %}">–°–±—Ä–æ—Å–∏—Ç—å</a>
            </form>
        </div>

        <table class="patient-table">
            <thead>
                <tr>
                    <th>ID –ø–∞—Ü–∏–µ–Ω—Ç–∞</th>
                    <th>–£—Ä–æ–≤–µ–Ω—å —Å—Ä–æ—á–Ω–æ—Å—Ç–∏</th>
                    <th>–î–∏–∞–≥–Ω–æ–∑</th>
                    <th>–ú–∞—Ä—à—Ä—É—Ç</th>
                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>
            <tbody>
                {% for patient in patients %}
                <tr class="urgency-{{ patient.urgency_level }}">
                    <td><strong>{{ patient.encrypted_id }}</strong></td>
                    <td>{{ patient.get_urgency_display }}</td>
                    <td>{{ patient.diagnosis|default:"-"|truncatewords:8 }}</td>
                    <td>
                        {% if patient.clinical_route.current_department %}
                            {{ patient.clinical_route.current_department }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>{{ patient.created_at|date:"d.m.Y H:i" }}</td>
                    <td>
                        {% if patient.is_active %}
                            <span style="color: green;">‚óè –ê–∫—Ç–∏–≤–µ–Ω</span>
                        {% else %}
                            <span style="color: red;">‚óè –ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="empty-message">
                        –ü–∞—Ü–∏–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div style="margin-top: 20px;">
            <p>–í—Å–µ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤: {{ patients.count }}</p>
        </div>
    </div>
</body>
</html>